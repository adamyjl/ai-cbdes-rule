# 页面设计文档：任务结果发布

## 全局设计（适用于本模块所有页面）
### Layout
- 桌面优先：内容区最大宽度 1200–1360px，左右留白自适应；核心信息采用两栏（主内容 + 右侧摘要）布局。
- 布局方式：整体 Flexbox；列表区域用 CSS Grid（卡片/表格切换）；抽屉/弹窗用于“档案摘要”“入库明细”。
- 响应式：
  - ≥1200px：双栏（主 8/12 + 侧 4/12）
  - 768–1199px：主内容单栏，摘要折叠为右侧抽屉按钮
  - <768px：单栏堆叠（本版本仍以桌面体验为主）

### Meta Information
- 标题：任务结果发布
- 描述：将门禁通过的任务生成结果发布为版本，并同步入库与回放验证。
- Open Graph：title 同上；description 同上；type=website

### Global Styles（设计令牌）
- 背景：#0B1020（深色）或 #F7F8FA（浅色，二选一保持一致）
- 主色：#4F46E5（Primary）
- 强调成功：#16A34A；警告：#F59E0B；错误：#DC2626
- 文本：主文本 #111827 / 次级 #6B7280（浅色主题）
- 字体：系统字体 + 等宽用于版本号与 ID（如 ui-monospace）
- 组件：
  - Button：Primary/Secondary/Danger；hover 提升亮度 8% + 轻微阴影
  - Link：主色下划线 hover
  - Tag：用于状态（passed/failed、ok/partial/failed、running）

---

## 页面 1：任务结果发布（/publish）
### Page Structure
- 顶部：页面标题 + 面包屑（任务 / 发布）+ 右侧“查看发布档案”入口
- 主体：两栏布局
  - 左（主）：发布编排流程（分区卡片自上而下）
  - 右（侧）：发布摘要与校验（版本号、状态、可发布条件、风险提示）
- 底部：固定操作条（取消/保存草稿/发布）

### Sections & Components
1) 顶部导航区
- Breadcrumb：任务列表/任务详情（如存在）→ 任务结果发布
- CTA：按钮「发布档案」跳转 /publish/archives

2) 卡片：发布源选择（门禁通过）
- 内容：任务 ID、生成结果列表（表格）
  - 列：结果 ID、生成时间、门禁状态（Tag）、摘要
  - 行操作：选择（Radio）
- 交互：
  - 若选择的结果非 passed：禁用选择并提示原因
  - 选择后触发右侧摘要刷新

3) 卡片：版本号
- 展示：Version（等宽字体）、生成规则提示（只读说明）
- 操作：
  - 「预生成/刷新」按钮（仅在未发布状态可用）
  - 生成后显示“锁定将发生于发布确认”提示

4) 卡片：RAG 入库
- 入口：Toggle「跳过/入库」
- 入库配置：
  - 选择索引（Select）+ 新建索引（Input + Create）
  - 范围（Radio）：仅本次结果 / 包含依赖
- 状态区：进度条 + 最近一次执行结果（成功/失败/跳过）+ “查看明细”抽屉

5) 卡片：模块入库
- 入口：Toggle「跳过/入库」
- 配置：命名空间（Input/Select）
- 结果：写入条目数、冲突数、失败数；“查看冲突”弹窗

6) 卡片：回放验证
- 入口：按钮「基于发布快照回放」
- 参数：模式（validate/debug）
- 输出：状态 Tag + 关键结论（短文）+ “查看日志”链接（Storage 文件）
- 说明：回放以“当前页面快照/或已落档快照”为准

7) 右侧：发布摘要（Sticky）
- 字段：已选 gateResultId、版本号、RAG 状态、模块状态、回放状态
- 可发布条件：
  - 必须：门禁 passed；版本号已生成
  - 建议：RAG/模块/回放成功（但允许显式跳过）
- 风险提示：以 Alert 展示（如入库失败但仍要发布）

8) 底部固定操作条
- 主按钮：「发布并入档」
- 次按钮：取消/返回
- 防误触：发布时弹出确认弹窗（展示版本号 + 将写入的档案摘要）

---

## 页面 2：发布档案（/publish/archives）
### Page Structure
- 顶部：标题 + 筛选条
- 主体：档案列表（表格为主）

### Sections & Components
1) 筛选条（Inline Form）
- 输入：任务 ID、版本号、操作者、时间范围
- 下拉：状态（ok/partial/failed）
- 操作：查询/重置

2) 表格：档案列表
- 列：创建时间、任务 ID、版本号、状态、操作者、摘要
- 行点击：进入详情 /publish/archives/:archiveId
- 快捷操作：
  - 「加载到发布页」：跳转 /publish?archiveId=xxx

---

## 页面 3：回放（/publish/replay/:archiveId）
### Page Structure
- 顶部：标题 + 档案基本信息条（version、taskId、状态）
- 主体：左右布局
  - 左：回放运行区（控制 + 日志）
  - 右：对比与结论区

### Sections & Components
1) 回放控制区
- 按钮：开始回放/停止（如支持）/重新回放
- 参数：mode（validate/debug）只读或可切换

2) 日志与输出
- Tabs：关键日志 / 全量日志 / 输出摘要
- 日志渲染：等宽字体 + 分级高亮（error/warn/info）

3) 对比与结论
- 结论卡片：一致/不一致/失败 + 简短原因
- 资源区：下载日志、查看产物（Storage 链接）
- 返回：按钮「返回发布档案详情」
